<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | Rival</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
<div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar soft-shadow">
        <div>
            <h2>RIVAL</h2>
            <div class="sidebar-tagline">Competitive intelligence</div>
        </div>

        <nav>
            <a href="{{ url_for('main.dashboard') }}" class="active">
                <span class="label"><span class="dot"></span><span>Dashboard</span></span>
            </a>

            <a href="{{ url_for('main.watchlist') }}">
                <span class="label"><span class="dot"></span><span>Watchlist</span></span>
            </a>

            <a href="{{ url_for('main.companies') }}">
                <span class="label"><span class="dot"></span><span>Bedrijven</span></span>
            </a>

            <a href="{{ url_for('main.weekly_mail_settings') }}">
                <span class="label"><span class="dot"></span><span>Newsletter</span></span>
            </a>

            <a href="{{ url_for('main.logout') }}">
                <span class="label"><span class="dot"></span><span>Uitloggen</span></span>
            </a>
        </nav>

        <div class="sidebar-footer">
            Rival · v0.1 · Internal demo
        </div>
    </aside>

    <!-- MAIN -->
    <main class="content fade-in">

        <!-- TOP BAR -->
        <div class="topbar">
            <div class="topbar-left">
                <h1>Intelligence Dashboard</h1>
                <p class="subtitle">Start nieuwe analyses, beheer je watchlist en bekijk recente signalen.</p>
            </div>
        </div>

        <!-- STATISTIEKEN -->
        <div class="grid-3">
            <div class="stat-card">
                <div class="stat-label">Geanalyseerde websites</div>
                <div class="stat-value">–</div>
                <div class="stat-trend">Supabase-sync in volgende fase</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Actieve watchlist</div>
                <div class="stat-value">{{ watchlist|length if watchlist else 0 }}</div>
                <div class="stat-trend">Handmatige selectie</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Ongelezen alerts</div>
                <div class="stat-value">{{ alerts|length if alerts else 0 }}</div>
                <div class="stat-trend">Strategische changes</div>
            </div>
        </div>

        <!-- NIEUWE ANALYSE -->
        <section class="card soft-shadow fade-in" style="margin-bottom:20px;">
            <div class="card-header">
                <h2 class="card-title">Nieuwe Websiteanalyse</h2>
                <div class="card-meta">Rival genereert automatisch een baseline rapport.</div>
            </div>
            <div class="card-body">
                <a href="{{ url_for('main.scrape') }}" class="button full">
                    Nieuwe analyse starten →
                </a>
            </div>
        </section>

        <!-- WATCHLIST -->
        <section class="card card-muted soft-shadow fade-in">
            <div class="card-header">
                <h2 class="card-title">Watchlist</h2>
                <div class="card-meta">Je gevolgde bedrijven.</div>
            </div>

            <div class="card-body">
                {% if watchlist %}
                    <ul class="soft-list">
                        {% for item in watchlist %}
                            <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="subtitle">Nog geen bedrijven in watchlist.</p>
                {% endif %}
            </div>
        </section>

        <!-- CONFIG BLOCK -->
        <section class="card soft-shadow fade-in" style="margin-top:20px;">
            <div class="card-header">
                <h2 class="card-title">Configureer Watchlist & Competitors</h2>
                <div class="card-meta">Selecteer bedrijven, metrics én competitors.</div>
            </div>

            <div class="card-body">
                
                <!-- WATCHLIST CONFIG -->
                <form method="POST" style="margin-bottom: 20px;">
                    <input type="hidden" name="form_type" value="watchlist_config">
                    <h3>Watchlist instellingen</h3>

                    <div class="grid-2">

                        <!-- COMPANIES -->
                        <div>
                            <h4>Bedrijven</h4>
                            <ul class="soft-list" style="max-height:180px; overflow:auto;">
                                {% for c in companies %}
                                <li>
                                    <label style="display:flex;gap:6px;">
                                        <input type="checkbox" name="companies" value="{{ c.company_id }}"
                                            {% if c.company_id in session.get('watchlist_companies',[]) %}checked{% endif %}>
                                        {{ c.name }}
                                    </label>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>

                        <!-- METRICS -->
                        <div>
                            <h4>Metrics</h4>
                            <ul class="soft-list" style="max-height:180px; overflow:auto;">
                                {% for m in metric_options %}
                                <li>
                                    <label style="display:flex;gap:6px;">
                                        <input type="checkbox" name="metrics" value="{{ m }}"
                                            {% if m in metrics_selected %}checked{% endif %}>
                                        {{ m }}
                                    </label>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>

                    </div>

                    <button type="submit" class="button" style="margin-top:10px;">Opslaan</button>
                </form>

                <!-- COMPETITOR CONFIG -->
                <form method="POST">
                    <input type="hidden" name="form_type" value="competitor_config">

                    <h3>Competitor tracking</h3>
                    <p class="subtitle">Selecteer welke competitors gevolgd moeten worden in alerts.</p>

                    <ul class="soft-list" style="max-height:200px; overflow:auto;">

                        {% for comp in all_competitors %}
                        <li>
                            <label style="display:flex;gap:6px;">
                                <input type="checkbox" name="competitors"
                                    value="{{ comp }}"
                                    {% if comp in competitors_selected %}checked{% endif %}>
                                {{ comp }}
                            </label>
                        </li>
                        {% endfor %}
                    </ul>

                    <button type="submit" class="button" style="margin-top:10px;">Opslaan</button>
                </form>

            </div>
        </section>

        <!-- ALERTS -->
        <section class="card card-muted soft-shadow fade-in">
            <div class="card-header">
                <h2 class="card-title">Recente meldingen</h2>
                <div class="card-meta">Strategische updates</div>
            </div>

            <div class="card-body">

                {% if alerts %}
                    <ul class="soft-list">
                    {% for a in alerts %}
                        <li style="margin-bottom: 10px;">
                            <strong>{{ a.type }}</strong> —
                            <a href="{{ url_for('main.company_detail', company_id=a['company_id']) }}">
                                {{ a.description }}
                            </a>
                            <br>
                            <span class="badge-soft">{{ a.time.strftime('%Y-%m-%d') }}</span>
                        </li>
                    {% endfor %}
                    </ul>

                    {% if more_alerts_count > 0 %}
                    <div style="margin-top:8px;">
                        <a class="button" href="{{ url_for('main.all_alerts') }}">
                            Meer meldingen ({{ more_alerts_count }})
                        </a>
                    </div>
                    {% endif %}

                {% else %}
                    <p class="subtitle">Geen nieuwe meldingen.</p>
                {% endif %}
            </div>
        </section>

    </main>
</div>
</body>
</html>




