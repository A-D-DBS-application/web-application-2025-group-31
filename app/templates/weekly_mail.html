{% extends "base.html" %}
{% block title %}Digest Instellingen | Rival{% endblock %}

{% block content %}

<div class="topbar">
  <div class="topbar-left">
    <h1>Digest Instellingen</h1>
    <div class="subtitle">Beheer uw wekelijkse e-mailnotificaties en inhoud</div>
  </div>

  <div class="topbar-right">
    <span class="badge-soft">Ingelogd als {{ session.get('username') }}</span>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h2 class="card-title">Instellingen Wekelijkse Digest</h2>
    <span class="card-meta">E-mailfrequentie en Signaaltypes</span>
  </div>

  <div class="card-body">
    <form action="{{ url_for('main.update_weekly_mail') }}" method="POST">

      <div class="form-group">
        <label for="frequency" class="form-label">Frequentie</label>

        <select id="frequency" name="frequency" class="form-control">
          <option value="" {% if not user.digest_frequency or user.digest_frequency == '' %}selected{% endif %}>
            Digest uitschakelen (Geen mails)
          </option>
          <option value="weekly" {% if user.digest_frequency == 'weekly' %}selected{% endif %}>Wekelijks</option>
          <option value="biweekly" {% if user.digest_frequency == 'biweekly' %}selected{% endif %}>Twee-wekelijks</option>
          <option value="monthly" {% if user.digest_frequency == 'monthly' %}selected{% endif %}>Maandelijks</option>
        </select>

        <small class="form-help">Kies hoe vaak u de samenvatting wilt ontvangen.</small>
      </div>

      <hr class="form-separator">

      <div class="form-group">
        <label class="form-label">Gedetecteerde Signalen Opnemen</label>

        {% set available_signals = [
          ('pricing_change', 'Prijs- en abonnementswijzigingen'),
          ('new_feature', 'Nieuwe key features/producten'),
          ('segment_change', 'Wijzigingen in het target segment/doelgroep'),
          ('hiring', 'Aanzienlijke aanwervingen of groei van het team'),
          ('funding', 'Nieuwe financieringsrondes of investeringen')
        ] %}

        <div class="checkbox-group">
          {% for value, label in available_signals %}
            <label class="checkbox-container">
              <input
                type="checkbox"
                name="digest_signals"
                value="{{ value }}"
                {% if value in (user.digest_signals or []) %}checked{% endif %}
              >
              <span class="checkbox-label">{{ label }}</span>
            </label>
          {% endfor %}
        </div>

        <small class="form-help">Selecteer welke strategische veranderingen u wilt zien in de digest.</small>
      </div>

      <button type="submit" class="button mt-20">
        Instellingen Opslaan
      </button>

    </form>
  </div>
</div>

<div class="card card-muted mt-20">
  <div class="card-header">
    <h2 class="card-title">Voorbeeld van wekelijkse mail</h2>
    <div class="card-meta">Dit is een preview van wat Rival u zou sturen, gebaseerd op uw voorkeuren.</div>
  </div>

  <div class="card-body">
    <p><strong>Weekly Competitive Digest</strong></p>
    <p class="subtitle mb-14">
      Hier is een voorbeeld van hoe uw wekelijkse update eruit zou zien.
    </p>

    <ul class="soft-list">
      <li>
        <strong>CompetitorOne</strong><br>
        • Nieuwe feature gelanceerd: “AI Analytics Dashboard”<br>
        • Website traffic +12% volgens SimilarWeb<br>
        • Hiring: 3 nieuwe engineering posities
      </li>

      <li>
        <strong>CompetitorTwo</strong><br>
        • Pricing update: Starter plan verhoogd van €29 → €39<br>
        • 1 nieuwe review op TrustPilot (4 ★)<br>
        • Blogpost: “Ons 2025 Product Vision”
      </li>

      <li>
        <strong>Markttrends</strong><br>
        • Funding: €18M Series A voor StartupX in dezelfde niche<br>
        • Regulatory update: EU data-compliance wijziging vanaf juni 2025
      </li>
    </ul>

    <p class="card-meta mt-12">
      Opmerking: dit is een demo-voorbeeld.
      De echte mails tonen enkel bedrijven uit uw watchlist met <code>digest_enabled = True</code> en de geselecteerde signaaltypes.
    </p>
  </div>
</div>

{% endblock %}





