{% extends "base.html" %}
{% block title %}{{ company.name }} | Baseline Report{% endblock %}

{% block head %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}

<div class="topbar">
  <div class="topbar-left">
    <h1>{{ company.name }}</h1>
    <p class="subtitle">Volledig automatisch gegenereerd baseline rapport.</p>
  </div>
</div>

<a href="{{ url_for('main.companies') }}" class="button mb-14">← Terug naar bedrijven</a>

<div class="export-row mb-20">
  <a class="button small action-btn" href="{{ url_for('main.export_company', company_id=company.company_id, format='json') }}">Export JSON</a>
  <a class="button small action-btn" href="{{ url_for('main.export_company', company_id=company.company_id, format='csv') }}">Export CSV</a>
  <a class="button small action-btn" href="{{ url_for('main.export_company', company_id=company.company_id, format='txt') }}">VC Memo</a>
  <a class="button small action-btn" href="{{ url_for('main.export_pdf', company_id=company.company_id) }}">Export PDF</a>
  <a class="button small action-btn" href="{{ url_for('main.export_slides', company_id=company.company_id) }}">Export Slides</a>
</div>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">Bedrijfsinformatie</h2>
    <div class="card-meta">Website en identiteit</div>
  </div>
  <div class="card-body">
    <p><strong>Website:</strong><br>
      {% if company.website_url %}
        <a href="{{ company.website_url }}" target="_blank" rel="noopener noreferrer">{{ company.website_url }}</a>
      {% else %}
        <span class="tag">Geen website</span>
      {% endif %}
    </p>

    <p class="mt-15"><strong>Sector:</strong><br>
      {% if company.sector %}
        <span class="tag tag-sector">{{ company.sector.name }}</span>
      {% else %}
        <span class="tag tag-unknown">Nog niet ingedeeld</span>
      {% endif %}
    </p>
  </div>
</section>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">AI Summary</h2>
    <div class="card-meta">Gegenereerd via scraping + AI</div>
  </div>
  <div class="card-body">
    <p>{{ company.ai_summary or "Geen samenvatting beschikbaar" }}</p>
  </div>
</section>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">Value Proposition</h2>
  </div>
  <div class="card-body">
    <p>{{ company.value_proposition or "Onbekend" }}</p>
  </div>
</section>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">Productbeschrijving</h2>
  </div>
  <div class="card-body">
    <p>{{ company.product_description or "Geen productinformatie beschikbaar" }}</p>
  </div>
</section>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">Doelgroep</h2>
  </div>
  <div class="card-body">
    <p>{{ company.target_segment or "Onbekend segment" }}</p>
  </div>
</section>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">Pricing</h2>
  </div>
  <div class="card-body">
    <p>{{ company.pricing or "Geen pricing gevonden" }}</p>
  </div>
</section>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">Belangrijkste Features</h2>
  </div>
  <div class="card-body">
    {% if company.key_features %}
      <ul class="soft-list">
        {% for f in company.key_features %}
          <li>{{ f }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="subtitle">Geen features gedetecteerd.</p>
    {% endif %}
  </div>
</section>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">Competitive Landscape</h2>
    <div class="card-meta">Automatisch gedetecteerde vergelijkbare bedrijven</div>
  </div>
  <div class="card-body">
    {% if company.competitors %}
      <ul class="soft-list">
        {% for c in company.competitors %}
          <li>{{ c }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="subtitle">Geen concurrenten gevonden.</p>
    {% endif %}
  </div>
</section>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">Business Fundamentals</h2>
    <div class="card-meta">Kernindicatoren gedetecteerd via AI</div>
  </div>
  <div class="card-body">
    <p><strong>Headquarters:</strong><br>{{ company.headquarters or "Onbekend" }}</p>

    <p><strong>Office Locations:</strong><br>
      {% if company.office_locations %}{{ company.office_locations }}{% else %}Niet beschikbaar{% endif %}
    </p>

    <p><strong>Team Size:</strong><br>{{ company.team_size or "Onbekend" }}</p>

    <p><strong>Total Funding:</strong><br>
      {% if company.funding %}
        {{ company.funding }}
      {% elif company.funding_history %}
        {{ company.funding_history }}
      {% else %}
        Onbekend
      {% endif %}
    </p>

    <p><strong>Funding History:</strong><br>{{ company.funding_history or "Geen gegevens" }}</p>
  </div>
</section>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">Traction Signals</h2>
    <div class="card-meta">Gedetecteerde groei / activiteit</div>
  </div>
  <div class="card-body">
    <p>{{ company.traction_signals or "Geen signalen" }}</p>
  </div>
</section>

<section class="card soft-shadow fade-in mt-20">
  <div class="card-header">
    <h2 class="card-title">Historische trends</h2>
    <div class="card-meta">AI-reconstructie aangevuld met live scrapes</div>
  </div>

  <div class="card-body">
    {% if pricing_labels or hiring_labels or review_labels %}

      <div class="trend-grid">
        <div>
          <h3 class="card-subtitle">Pricing evolution</h3>
          <canvas id="priceChart"></canvas>
        </div>

        <div>
          <h3 class="card-subtitle">Hiring activity</h3>
          <canvas id="hiringChart"></canvas>
        </div>

        <div class="trend-grid-full">
          <h3 class="card-subtitle">Review volume</h3>
          <canvas id="reviewChart"></canvas>
        </div>
      </div>

    {% else %}
      <p class="subtitle">
        Nog geen historiek beschikbaar. Scrape deze website meerdere keren om trends op te bouwen.
      </p>
    {% endif %}
  </div>
</section>

<section class="card soft-shadow fade-in mt-20">
  <div class="card-header">
    <h2 class="card-title">Strategische wijzigingen</h2>
    <div class="card-meta">Automatisch gedetecteerde veranderingen</div>
  </div>

  <div class="card-body">
    {% if events and events|length > 0 %}
      <ul class="soft-list">
        {% for e in events[:3] %}
          <li class="list-item-8">
            <strong>{{ e.event_type }}</strong><br>
            {{ e.description }}<br>
            <span class="badge-soft">{{ e.detected_at.strftime('%Y-%m-%d') }}</span>
          </li>
        {% endfor %}
      </ul>

      {% if events|length > 3 %}
        <a href="{{ url_for('main.company_alerts', company_id=company.company_id) }}"
           class="button mt-10">
          Bekijk alle wijzigingen →
        </a>
      {% endif %}
    {% else %}
      <p class="subtitle">Geen wijzigingen gedetecteerd.</p>
    {% endif %}
  </div>
</section>

{% endblock %}

{% block scripts %}
<script>
  const pricingLabels = {{ pricing_labels|tojson }};
  const pricingValues = {{ pricing_values|tojson }};

  const hiringLabels = {{ hiring_labels|tojson }};
  const hiringValues = {{ hiring_values|tojson }};

  const reviewLabels = {{ review_labels|tojson }};
  const reviewValues = {{ review_values|tojson }};

  function buildLineChart(canvasId, labels, data, label) {
    const canvas = document.getElementById(canvasId);
    if (!canvas || !labels || labels.length === 0) return;

    new Chart(canvas.getContext('2d'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: label,
          data: data,
          tension: 0.25,
          fill: false
        }]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: false } }
      }
    });
  }

  buildLineChart('priceChart', pricingLabels, pricingValues, 'Pricing score');
  buildLineChart('hiringChart', hiringLabels, hiringValues, 'Hiring activity');
  buildLineChart('reviewChart', reviewLabels, reviewValues, 'Aantal reviews');
</script>
{% endblock %}

