{% extends "base.html" %}
{% block title %}Watchlist vergelijking | Rival{% endblock %}

{% block content %}

<div class="topbar">
  <div class="topbar-left">
    <h1>Watchlist vergelijking</h1>
    <p class="subtitle">Geselecteerde bedrijven tegenover gekozen metrics.</p>
  </div>
</div>

<section class="card soft-shadow fade-in">
  <div class="card-header">
    <h2 class="card-title">Vergelijkingstabel</h2>
    <div class="card-meta">Toont eenvoudige waarden of '–' wanneer onbekend.</div>
  </div>

  <div class="card-body">
    {% if not companies %}
      <p class="subtitle">Nog geen bedrijven in watchlist.</p>
    {% elif not metrics %}
      <p class="subtitle">Geen metrics geselecteerd (configureer op Dashboard).</p>
    {% else %}

      <div class="table-scroll">
        <table class="table">
          <thead>
            <tr>
              <th>Bedrijf</th>
              {% for m in metrics %}<th>{{ m }}</th>{% endfor %}
            </tr>
          </thead>

          <tbody>
            {% for row in rows %}
              <tr>
                <td>{{ row.company.name }}</td>
                {% for m in metrics %}
                  <td>{{ row.metrics[m] }}</td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="card-meta mt-16">
        <strong>Audit bronnen per bedrijf:</strong>
      </div>

      <ul class="audit-list mt-10">
        {% for c in companies %}
          <li>
            <strong>{{ c.name }}:</strong>

            {% set logs = logs_by_company.get(c.company_id, []) %}
            {% if logs %}
              {% for l in logs %}
                <span class="audit-chip">
                  {{ l.source_name }} ({{ l.retrieved_at or 'n/a' }})
                  {% if l.source_url %}
                    <a href="{{ l.source_url }}" target="_blank" rel="noopener noreferrer">↗</a>
                  {% endif %}
                </span>
              {% endfor %}
            {% else %}
              <em>Geen logs</em>
            {% endif %}
          </li>
        {% endfor %}
      </ul>

      <div class="export-row mt-16">
        <a class="button small action-btn" href="{{ url_for('main.export_watchlist_audit') }}?format=csv">Export CSV</a>
        <a class="button small action-btn" href="{{ url_for('main.export_watchlist_audit') }}?format=json">Export JSON</a>
      </div>

    {% endif %}
  </div>
</section>

{% endblock %}
